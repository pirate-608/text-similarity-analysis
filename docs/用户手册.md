# 用户手册

## 环境准备
- 需要 gcc/clang（C99）与 make。
- 依赖 POSIX `dirent.h`：Windows 建议使用 MSYS2/MinGW 或 WSL 终端。
- 文档需为 UTF-8 `.txt` 文件。

## 构建
```
make
```
产物：`build/bin/similarity`，测试可执行位于 `build/bin/test_*`。

## 运行方式
### Web 界面模式（推荐）
1. 编译核心库：
   ```bash
   make shared
   ```
2. 启动 Web 服务：
   ```bash
   python web/app.py
   ```
3. 访问 `http://127.0.0.1:5000`，在浏览器中上传文件并查看分析结果。
   > **提示**：如需公网访问，请参考 [NGROK_GUIDE.md](NGROK_GUIDE.md)。

### 交互模式（CLI）
```
./build/bin/similarity
```
- 菜单支持：加载目录、生成矩阵、查看 Top 相似对、按阈值筛选、热力图、统计信息。

### 批处理模式
```
./build/bin/similarity -d ./data -o similarity.csv -s stopwords.txt
```
- `-d <目录>`：必填，指向包含 `.txt` 的目录。
- `-o <文件>`：可选，输出相似度矩阵 CSV，默认 `similarity_matrix.csv`。
- `-s <文件>`：可选，附加停用词列表。
- 输出：Top10 相似对打印到终端，矩阵写入 CSV。

## 输入规范
- **Web 模式**：支持批量上传 `.txt` 文件，自动过滤非文本文件。
- **CLI 模式**：仅处理扩展名 `.txt` 的普通文件；其他文件会被跳过。
- 默认分词以字母和 `'` 组成单词，其余字符视为分隔符；处理前转换为小写。
- 停用词：内置常见英文停用词，若指定 `-s` 则附加用户自定义列表。

## 输出与查看
- **Web 界面**：
  - 交互式相似度矩阵表格。
  - 颜色编码（绿-黄-红）直观展示相似度高低。
  - 支持动态排序和筛选（未来功能）。
- **CLI 输出**：
  - CSV：行列均为文件名，单元格为相似度（对角线 1.0）。
  - Top 相似对：显示相似度最高的文档组合及数值。
  - 热力图：终端 ASCII 形式，默认展示前 20×20 子矩阵。
  - 统计：总词数、唯一词数、最长/最短文档等。

## 故障排查
- **Web 启动失败**：
  - 确保已安装 Python 3.x 和 Flask (`pip install flask`)。
  - 确保已执行 `make shared` 生成 `libsimilarity.dll` (Windows) 或 `libsimilarity.so` (Linux)。
  - 检查端口 5000 是否被占用。
- 编译找不到 `dirent.h`：在 Windows 改用 MSYS2/MinGW 或 WSL；Linux/macOS 默认提供。
- 运行无输出：确认目录下有 `.txt` 文件且非空。
- 相似度始终为 0：检查停用词是否过多、文本是否为空或完全不同；必要时移除停用词文件再试。

## 典型流程
1) **Web 体验**：运行 `python web/app.py`，上传 `samples/mini` 中的文件，直观感受分析结果。
2) **CLI 批处理**：准备 `samples/mini` 中的少量 `.txt` 示例，执行批处理模式验证。
3) **性能评估**：扩大到 `samples/small` 或 `samples/medium`，评估运行时间与矩阵大小。
4) **深入分析**：进入交互模式，使用热力图与筛选功能查看局部相似度分布。
